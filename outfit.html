<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Outfit Builder｜FitMatch</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header class="site-header">
  <div class="container nav">
    <a class="brand" href="index.html">FitMatch</a>
    <nav>
      <a href="index.html">首頁</a>
      <a href="gallery.html">實穿牆</a>
      <a href="outfit.html" class="active">Outfit Builder</a>
    </nav>
  </div>
</header>

<main class="container">
  <h1>Outfit Builder（拖拉拼搭）</h1>

  <div class="outfit-layout">
    <aside>
      <h3>可用單品</h3>
      <div id="catalog" class="catalog" draggable="false"></div>
    </aside>

    <section>
      <h3>拖到此區組合</h3>
      <div id="dropzone" class="dropzone" data-empty="把單品拖進來"></div>
      <div class="row">
        <button id="clear">清空</button>
        <button id="share">生成分享卡</button>
      </div>
      <a id="download" class="hidden" download="outfit.png">下載圖片</a>
    </section>
  </div>
</main>

<footer class="site-footer">
  <div class="container">© 2025 FitMatch Demo</div>
</footer>

<script type="module">
  import { el } from './js/dom.js';

  // 簡易目錄（可自行擴充或改抓 API）
  const items = [
    { id:'top-white',   name:'白T',    kind:'top',    color:'#f2f2f2' },
    { id:'top-black',   name:'黑T',    kind:'top',    color:'#111'    },
    { id:'top-navy',    name:'海軍藍襯衫', kind:'top', color:'#1a2a4a' },
    { id:'bottom-denim',name:'淺色牛仔', kind:'bottom', color:'#7da2c8' },
    { id:'bottom-chino',name:'卡其褲', kind:'bottom', color:'#c8a77d' },
    { id:'shoes-white', name:'白鞋',   kind:'shoes',  color:'#e9e9e9' },
    { id:'shoes-black', name:'黑鞋',   kind:'shoes',  color:'#333' },
  ];

  const catalog = document.getElementById('catalog');
  const zone = document.getElementById('dropzone');

  const makeCard = (it) => {
    const card = el('div', { class: 'piece', draggable: 'true', 'data-id': it.id, style:`--c:${it.color}` }, [
      el('div', { class: 'swatch' }),
      el('div', { class: 'label' }, `${it.name} · ${it.kind}`)
    ]);
    card.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text/plain', it.id);
    });
    return card;
  };

  items.forEach(it => catalog.appendChild(makeCard(it)));

  zone.addEventListener('dragover', e => e.preventDefault());
  zone.addEventListener('drop', e => {
    e.preventDefault();
    const id = e.dataTransfer.getData('text/plain');
    const item = items.find(x => x.id === id);
    if (!item) return;
    zone.appendChild(makeCard(item));
    zone.removeAttribute('data-empty');
  });

  document.getElementById('clear').addEventListener('click', () => {
    zone.innerHTML = '';
    zone.setAttribute('data-empty', '把單品拖進來');
    document.getElementById('download').classList.add('hidden');
  });

  // 生成分享卡（把 dropzone 轉成 Canvas 再下載）
  document.getElementById('share').addEventListener('click', async () => {
    // 簡易渲染：將每個 piece 畫成矩形 + 字
    const pieces = Array.from(zone.querySelectorAll('.piece'));
    if (!pieces.length) return alert('請先拖入單品！');

    const canvas = document.createElement('canvas');
    const w = 720, h = 480;
    canvas.width = w; canvas.height = h;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#fafafa';
    ctx.fillRect(0,0,w,h);

    // 標題
    ctx.fillStyle = '#111';
    ctx.font = '20px system-ui, -apple-system, Segoe UI, Roboto';
    ctx.fillText('My Outfit', 24, 36);

    // 佈局：三欄
    const col = 3, gap = 16, cardW = (w - 24*2 - gap*(col-1))/col, cardH = 140;
    pieces.forEach((p, i) => {
      const color = getComputedStyle(p).getPropertyValue('--c').trim() || '#ddd';
      const name = p.querySelector('.label').textContent;
      const x = 24 + (i % col)*(cardW+gap);
      const y = 60 + Math.floor(i/col)*(cardH+gap);

      ctx.fillStyle = color;
      ctx.fillRect(x, y, cardW, cardH);

      ctx.strokeStyle = '#00000022';
      ctx.strokeRect(x, y, cardW, cardH);

      ctx.fillStyle = '#111';
      ctx.font = '16px system-ui, -apple-system, Segoe UI, Roboto';
      ctx.fillText(name, x+12, y+cardH-12);
    });

    const url = canvas.toDataURL('image/png');
    const a = document.getElementById('download');
    a.href = url;
    a.classList.remove('hidden');
  });
</script>
</body>
</html>
